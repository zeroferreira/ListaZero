<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade - Zero FM</title>
    <link rel="stylesheet" href="styles.css?v=2.11">
    <style>
        * { box-sizing: border-box; } /* Reset b√°sico */
        
        /* Estilos espec√≠ficos para Arcade */
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Avenir', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
            overflow-y: auto; /* Permitir scroll siempre */
        }

        /* Fondo de orbs heredado */
        .immersive-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: orbFloat 20s infinite ease-in-out;
        }
        .orb-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #ff0050; animation-delay: 0s; }
        .orb-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: #00f2ea; animation-delay: -5s; }
        .orb-3 { top: 40%; left: 40%; width: 40vw; height: 40vw; background: #8a2be2; animation-delay: -10s; }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* HEADER */
        .arcade-header {
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            margin-bottom: 20px;
            flex-shrink: 0;
            z-index: 10;
        }
        
        svg text {
            font-family: 'Courier New', monospace;
            font-weight: 900;
            font-size: 50px;
            fill: transparent;
            stroke: #fff;
            stroke-width: 2px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px #ff0050;
            animation: textGlow 3s infinite alternate;
        }
        
        @keyframes textGlow {
            0% { stroke: #fff; text-shadow: 0 0 10px #ff0050; }
            100% { stroke: #ff0050; text-shadow: 0 0 20px #00f2ea, 0 0 40px #ff0050; }
        }

        /* MAIN GRID */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            padding-bottom: 50px;
            z-index: 10;
        }

        .game-card {
            background: rgba(20, 20, 30, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            min-height: 180px;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-5px);
            border-color: #ff0050;
            box-shadow: 0 10px 30px rgba(255, 0, 80, 0.3);
            background: rgba(30, 30, 45, 0.9);
        }

        .game-card h3 {
            margin: 0 0 15px 0;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #fff;
        }

        .game-card .play-btn {
            background: linear-gradient(45deg, #ff0050, #ff0070);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s;
        }
        
        .game-card:hover .play-btn {
            transform: scale(1.1);
        }

        .game-card.disabled {
            opacity: 0.6;
            cursor: default;
            border-color: #333;
        }
        
        .game-card.disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .game-card.disabled .play-btn {
            background: #444;
            color: #888;
        }

        /* GAME OVERLAY (Fullscreen) */
        #game-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 2000;
            flex-direction: column;
        }

        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Bot√≥n Volver (Flotante) */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 24px;
            backdrop-filter: blur(5px);
            z-index: 3000;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .back-btn:hover {
            background: rgba(255, 0, 80, 0.8);
            transform: scale(1.1);
        }

        /* Loading Screen for Visitors */
        #visitor-overlay {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            text-align: center;
            z-index: 100;
        }

        .coming-soon-msg { font-size: 24px; color: #ff0050; font-weight: bold; margin-bottom: 10px; }
        .arcade-loading-text { 
            color: #00ff00; 
            font-family: monospace; 
            font-size: 20px; 
            animation: blink 1s infinite; 
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* HUD Controls */
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 120px;
            z-index: 2100;
            pointer-events: none;
        }

        .dpad-btn {
            position: absolute;
            width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 24px;
            pointer-events: auto;
            backdrop-filter: blur(4px);
        }
        
        .dpad-btn:active { background: rgba(255, 0, 80, 0.5); }
        .btn-up { top: 0; left: 75px; }
        .btn-down { bottom: 0; left: 75px; }
        .btn-left { top: 35px; left: 15px; }
        .btn-right { top: 35px; right: 15px; }

        @media (max-width: 768px) {
            .mobile-controls { display: block; }
            .games-grid { grid-template-columns: 1fr; width: 85%; }
            .game-card { min-height: 120px; flex-direction: row; justify-content: space-between; padding: 20px; }
            .game-card h3 { margin: 0; font-size: 18px; text-align: left; }
            .game-card .play-btn { padding: 8px 20px; font-size: 12px; }
        }
    </style>
</head>
<body>

    <!-- Fondo -->
    <div class="immersive-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Bot√≥n Volver -->
    <a href="lista.html" class="back-btn" id="main-back-btn">‚Üê</a>

    <!-- Header -->
    <div class="arcade-header">
        <svg width="300" height="100" viewBox="0 0 300 100">
            <path id="curve" d="M30,80 Q150,10 270,80" fill="transparent"/>
            <text width="300">
                <textPath xlink:href="#curve" startOffset="50%" text-anchor="middle">
                    ARCADE
                </textPath>
            </text>
        </svg>
    </div>

    <!-- Visitor View -->
    <div id="visitor-overlay">
        <div class="coming-soon-msg">¬°Muy pronto! ü´¢</div>
        <div class="arcade-loading-text">LOADING...</div>
    </div>

    <!-- Games Grid (Admin Only) -->
    <div class="games-grid" id="games-grid">
        <!-- Cards generated by JS -->
    </div>

    <!-- Game Overlay (Fullscreen) -->
    <div id="game-overlay">
        <a href="#" class="back-btn" id="exit-game-btn" style="z-index: 3001;">‚úï</a>
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
            <div id="score-display" style="position: absolute; top: 20px; right: 20px; color: #fff; font-size: 20px; font-weight: bold; pointer-events: none;">SCORE: 0</div>
            
            <div id="game-over-screen" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); flex-direction: column; justify-content: center; align-items: center; z-index: 50;">
                <h2 style="color: #ff0050; font-size: 40px; margin-bottom: 20px;">GAME OVER</h2>
                <div id="final-score" style="color: #fff; font-size: 24px; margin-bottom: 30px;">Score: 0</div>
                <button id="restart-btn" style="background: #00f2ea; border: none; padding: 15px 40px; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer; color: #000;">REINTENTAR</button>
            </div>

            <!-- Mobile HUD -->
            <div id="mobile-controls" class="mobile-controls">
                <div class="dpad-btn btn-up" data-key="ArrowUp">‚Üë</div>
                <div class="dpad-btn btn-down" data-key="ArrowDown">‚Üì</div>
                <div class="dpad-btn btn-left" data-key="ArrowLeft">‚Üê</div>
                <div class="dpad-btn btn-right" data-key="ArrowRight">‚Üí</div>
            </div>
        </div>
    </div>

    <script>
        // --- GAME LIST ---
        const gamesList = [
            { id: 'SNAKE', name: 'Snake Classic', active: true },
            { id: 'PING PONG', name: 'Neon Pong', active: true },
            { id: 'GALAGA', name: 'Space Shooter', active: true },
            { id: 'COMING1', name: 'Juego 4', active: false },
            { id: 'COMING2', name: 'Juego 5', active: false },
            { id: 'COMING3', name: 'Juego 6', active: false },
        ];

        // --- ELEMENTS ---
        const grid = document.getElementById('games-grid');
        const visitorOverlay = document.getElementById('visitor-overlay');
        const gameOverlay = document.getElementById('game-overlay');
        const mainBackBtn = document.getElementById('main-back-btn');
        const exitGameBtn = document.getElementById('exit-game-btn');
        
        // --- AUTH CHECK ---
        const isAdmin = localStorage.getItem('isAdminMode') === 'true';

        if (!isAdmin) {
            grid.style.display = 'none';
            visitorOverlay.style.display = 'flex';
        } else {
            renderGrid();
        }

        function renderGrid() {
            grid.innerHTML = '';
            gamesList.forEach(game => {
                const card = document.createElement('div');
                card.className = `game-card ${game.active ? '' : 'disabled'}`;
                card.innerHTML = `
                    <h3>${game.name}</h3>
                    <button class="play-btn">${game.active ? 'JUGAR' : 'PRONTO'}</button>
                `;
                
                if (game.active) {
                    card.onclick = () => launchGame(game.id);
                }
                grid.appendChild(card);
            });
        }

        // --- GAME LAUNCHER ---
        let currentGame = null;
        let isGameRunning = false;

        function launchGame(gameId) {
            currentGame = gameId;
            isGameRunning = true;
            
            // UI Switch
            grid.style.display = 'none';
            mainBackBtn.style.display = 'none';
            document.querySelector('.arcade-header').style.display = 'none'; // Hide header for full immersion
            gameOverlay.style.display = 'flex';

            // Start Logic
            resizeCanvas();
            if (gameId === 'SNAKE') startSnakeGame();
            else if (gameId === 'PING PONG') startPongGame();
            else if (gameId === 'GALAGA') startGalagaGame();
        }

        function closeGame() {
            isGameRunning = false;
            currentGame = null;
            clearInterval(gameInterval);
            
            // UI Switch
            gameOverlay.style.display = 'none';
            grid.style.display = 'grid'; // Restore grid
            mainBackBtn.style.display = 'flex';
            document.querySelector('.arcade-header').style.display = 'flex';
        }

        exitGameBtn.onclick = (e) => {
            e.preventDefault();
            closeGame();
        };

        // --- GAME LOGIC VARS (Shared) ---
        const gameCanvas = document.getElementById('game-canvas');
        const ctx = gameCanvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');
        let gameInterval;

        restartBtn.onclick = () => {
            gameOverScreen.style.display = 'none';
            if (currentGame === 'SNAKE') startSnakeGame();
            else if (currentGame === 'PING PONG') startPongGame();
            else if (currentGame === 'GALAGA') startGalagaGame();
        };

        function resizeCanvas() {
            gameCanvas.width = window.innerWidth;
            gameCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', () => {
            if(isGameRunning) resizeCanvas();
        });

        // --- SNAKE ---
        let snake = [], food = {}, direction = 'right', nextDirection = 'right', score = 0, gridSize = 20;
        
        function startSnakeGame() {
            gridSize = Math.floor(Math.min(gameCanvas.width, gameCanvas.height) / 25);
            snake = [{x: 5, y: 5}, {x: 4, y: 5}, {x: 3, y: 5}];
            direction = 'right'; nextDirection = 'right'; score = 0;
            scoreDisplay.textContent = `SCORE: 0`;
            placeFood();
            gameInterval = setInterval(gameLoopSnake, 100);
        }

        function placeFood() {
            const cols = Math.floor(gameCanvas.width / gridSize);
            const rows = Math.floor(gameCanvas.height / gridSize);
            food = {
                x: Math.floor(Math.random() * cols),
                y: Math.floor(Math.random() * rows)
            };
        }

        function gameLoopSnake() {
            direction = nextDirection;
            const head = {x: snake[0].x, y: snake[0].y};
            if(direction === 'right') head.x++;
            else if(direction === 'left') head.x--;
            else if(direction === 'up') head.y--;
            else if(direction === 'down') head.y++;

            const cols = Math.floor(gameCanvas.width / gridSize);
            const rows = Math.floor(gameCanvas.height / gridSize);

            if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows || snake.some(p => p.x === head.x && p.y === head.y)) {
                gameOver(`Score: ${score}`);
                return;
            }

            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreDisplay.textContent = `SCORE: ${score}`;
                placeFood();
            } else snake.pop();

            // Draw
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            ctx.fillStyle = '#00f2ea';
            snake.forEach(p => ctx.fillRect(p.x*gridSize, p.y*gridSize, gridSize-2, gridSize-2));
            
            ctx.fillStyle = '#ff0050';
            ctx.fillRect(food.x*gridSize, food.y*gridSize, gridSize-2, gridSize-2);
        }

        // --- PONG ---
        let playerX = 0, aiX = 0, ballX = 0, ballY = 0, ballSX = 5, ballSY = 5, pScore = 0, aiScore = 0;
        let paddleW = 100, paddleH = 15;

        function startPongGame() {
            paddleW = gameCanvas.width * 0.25; // Responsive paddle
            playerX = (gameCanvas.width - paddleW)/2;
            aiX = playerX;
            ballX = gameCanvas.width/2;
            ballY = gameCanvas.height/2;
            pScore = 0; aiScore = 0;
            scoreDisplay.textContent = `P: 0 | CPU: 0`;
            gameInterval = setInterval(gameLoopPong, 16);
        }

        function gameLoopPong() {
            ballX += ballSX; ballY += ballSY;

            // Walls
            if(ballX < 0 || ballX > gameCanvas.width) ballSX *= -1;

            // AI
            const aiCenter = aiX + paddleW/2;
            if(aiCenter < ballX - 20) aiX += 7;
            else if(aiCenter > ballX + 20) aiX -= 7;
            aiX = Math.max(0, Math.min(gameCanvas.width - paddleW, aiX));

            // Paddles
            // Player Bottom
            if(ballY > gameCanvas.height - 40 && ballY < gameCanvas.height - 10 && ballX > playerX && ballX < playerX + paddleW) {
                ballSY = -Math.abs(ballSY);
                ballSX += (Math.random() - 0.5) * 4;
            }
            // AI Top
            if(ballY < 40 && ballY > 10 && ballX > aiX && ballX < aiX + paddleW) {
                ballSY = Math.abs(ballSY);
            }

            // Points
            if(ballY < 0) { pScore++; resetBall(); }
            if(ballY > gameCanvas.height) { aiScore++; resetBall(); }
            scoreDisplay.textContent = `P: ${pScore} | CPU: ${aiScore}`;

            // Draw
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            ctx.fillStyle = '#00f2ea'; // Player
            ctx.fillRect(playerX, gameCanvas.height - 30, paddleW, paddleH);
            ctx.fillStyle = '#ff0050'; // AI
            ctx.fillRect(aiX, 20, paddleW, paddleH);
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(ballX, ballY, 8, 0, Math.PI*2); ctx.fill();
        }

        function resetBall() {
            ballX = gameCanvas.width/2; ballY = gameCanvas.height/2;
            ballSY = 5 * (Math.random() > 0.5 ? 1 : -1);
        }

        // --- GALAGA (Simplified) ---
        let shipX = 0, bullets = [], enemies = [], gScore = 0;
        
        function startGalagaGame() {
            shipX = gameCanvas.width/2;
            bullets = []; enemies = []; gScore = 0;
            spawnEnemies();
            gameInterval = setInterval(gameLoopGalaga, 16);
        }

        function spawnEnemies() {
            for(let i=0; i<5; i++) {
                for(let j=0; j<3; j++) {
                    enemies.push({
                        x: 50 + i * 60, y: 50 + j * 50, w: 40, h: 40, active: true, dir: 1
                    });
                }
            }
        }

        function gameLoopGalaga() {
            // Logic would go here (similar to previous implementation but simplified for brevity in this refactor)
            // Re-using simplified render for now to prove concept
            
            // Player
            if(keys['ArrowLeft']) shipX -= 5;
            if(keys['ArrowRight']) shipX += 5;
            
            // Draw
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Ship
            ctx.fillStyle = '#00f2ea';
            ctx.fillRect(shipX, gameCanvas.height - 50, 40, 40);

            // Enemies
            enemies.forEach(e => {
                if(e.active) {
                    ctx.fillStyle = '#ff0050';
                    ctx.fillRect(e.x, e.y, e.w, e.h);
                    e.x += 2 * e.dir;
                    if(e.x > gameCanvas.width - 50 || e.x < 10) e.dir *= -1;
                }
            });
        }

        function gameOver(msg) {
            clearInterval(gameInterval);
            isGameRunning = false;
            finalScoreDisplay.textContent = msg;
            gameOverScreen.style.display = 'flex';
        }

        // --- CONTROLS ---
        const keys = {};
        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            if(currentGame === 'SNAKE') {
                if(e.key === 'ArrowUp' && direction !== 'down') nextDirection = 'up';
                if(e.key === 'ArrowDown' && direction !== 'up') nextDirection = 'down';
                if(e.key === 'ArrowLeft' && direction !== 'right') nextDirection = 'left';
                if(e.key === 'ArrowRight' && direction !== 'left') nextDirection = 'right';
            }
        });
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Mobile Touch
        document.querySelectorAll('.dpad-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const k = btn.dataset.key;
                keys[k] = true;
                // Snake direct turn
                if(currentGame === 'SNAKE') {
                    if(k === 'ArrowUp' && direction !== 'down') nextDirection = 'up';
                    if(k === 'ArrowDown' && direction !== 'up') nextDirection = 'down';
                    if(k === 'ArrowLeft' && direction !== 'right') nextDirection = 'left';
                    if(k === 'ArrowRight' && direction !== 'left') nextDirection = 'right';
                }
            });
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys[btn.dataset.key] = false;
            });
        });

    </script>

</body>
</html>